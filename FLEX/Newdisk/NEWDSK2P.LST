                      *********************************************************
                      *                                                       
*
                      * Double sided newdisk utility for Microbox II          
*
                      * Taken from supplied single sided version              
*
                      * and original TSC skeletal newdisk                     
*
                      *                                                       
*
                      * Last update - 18th September 1984                     
*
                      * Authors - TSC , Micro concepts and David Boreham      
*
                      *                                                       
*
                      * Adapted for Elektor EC-6809 by Ph. Roehr 11/2023      
*
                      *                                                       
*
                      *********************************************************


 000A                 SMAXS0  EQU     10      SD SIDE 0 MAX SECTOR
 0014                 SMAXS1  EQU     20      SD SIDE 1 MAX SECTOR
 0012                 DMAXS0  EQU     18      DD SIDE 0 MAX SECTOR
 0024                 DMAXS1  EQU     36      DD SIDE 1 MAX SECTOR

 0BEA                 TKSZ    EQU     3050    THIS VALUE IS FOR 5'1/4 BUT 
WORKS FOR 3'1/2 ON THE MICROBOX
                      *TKSZ    EQU     3123    THIS VALUE IS FOR 3'1/2

 0101                 FIRST   EQU     $0101   FIRST USER SECTOR
 000A                 SMAX0   EQU     10      SIDE 0 MAX SECTORS DEFAULT TO 10
 0800                 WORK    EQU     $0800

                      * STANDARD PRE-NAMED LABEL EQUATES

 CC0E                 SYSMTH  EQU     $CC0E
 CC10                 SYSYR   EQU     $CC10
 CD03                 WARMS   EQU     $CD03
 CD15                 GETCHR  EQU     $CD15
 CD18                 PUTCHR  EQU     $CD18
 CD1B                 INBUFF  EQU     $CD1B
 CD1E                 PSTRNG  EQU     $CD1E
 CD24                 PCRLF   EQU     $CD24
 CD2D                 GETFIL  EQU     $CD2D
 CD39                 OUTDEC  EQU     $CD39
 CD3C                 OUTHEX  EQU     $CD3C
 CD42                 GETHEX  EQU     $CD42
 CD45                 OUTADR  EQU     $CD45
 CD48                 INDEC   EQU     $CD48
 D403                 FMSCLS  EQU     $D403
 D406                 FMS     EQU     $D406

                      * ASCII CODE EQUATES

 0004                 EOT     EQU     $04
 0007                 BEL     EQU     $07

                      * EXTERNAL LABEL EQUATES

 EC0C                 DRVREG  EQU     $EC0C       DRIVE SELECT LATCH
 EC04                 COMREG  EQU     $EC04       FDC COMREG
 EC07                 DATREG  EQU     $EC07       FDC DATREG
 DE80                 DSKTAB  EQU     $DE80       EPROM DISK PARAM TABLE 
ADDRESS

 0020                 TRACK   EQU     $0020
 0021                 SECTOR  EQU     $0021
 0022                 BADCNT  EQU     $0022
 0023                 DRN     EQU     $0023
 0024                 SIDE    EQU     $0024
 0025                 DBSDF   EQU     $0025
 0026                 DENSE   EQU     $0026
 0027                 DNSITY  EQU     $0027
 002A                 SECCNT  EQU     $002A
 002C                 FSTAVL  EQU     $002C
 002E                 LSTAVL  EQU     $002E
 0030                 MAXS0   EQU     $0030
 0031                 MAXS1   EQU     $0031
 0032                 MAX     EQU     $0032
 0034                 FKFCB   EQU     $0034
 0038                 VOLNAM  EQU     $0038
 0043                 VOLNUM  EQU     $0043
 0815                 L0815   EQU     $0815       #WORK + $15 (+21) ?? INFO 
RECORD ??
 081E                 L081E   EQU     $081E       #WORK + $1E (+30) SD POST 
INDEX $FF LIMIT
 083C                 L083C   EQU     $083C       #WORK + $3C (+60) DD POST 
INDEX $4E LIMIT
 13EA                 SWKEND  EQU     WORK+TKSZ
 1FD4                 DWKEND  EQU     SWKEND+TKSZ

 DE03                 DWRITE  EQU     $DE03
                      *REST    EQU     $DE09
 DE1B                 DSEEK   EQU     $DE1B
 DE0F                 DCHECK  EQU     $DE0F
 DE0C                 DDRIVE  EQU     $DE0C

                              ORG     $0033
                              
 0033 28              TRACKS  FCB     40          DEFAULT TO 40 TRACKS

                              ORG     $0100

 0100 200C            NEWDISK BRA     FORM1       BEGIN       
 0102 02                      FCB     $02

 0103 BDCD1E          OUTIN   JSR     PSTRNG      DISPLAY STRING
 0106 BDCD15          OUTIN2  JSR     GETCHR      GET RESPONSE
 0109 845F                    ANDA    #$5F        UPPER CASE
 010B 8159                    CMPA    #'Y         COMPARE TO Y SO Z IS SET IF 
YES
 010D 39                      RTS

 010E BDCD24          FORM1   JSR     PCRLF
 0111 860A                            LDA     #SMAX0      INIT PARAM FOR SD
 0113 B70030                  STA     >MAXS0
 0116 B70032                  STA     >MAX
 0119 8614                    LDA     #SMAXS1
 011B B70031                  STA     >MAXS1
 011E BDCD42                  JSR     GETHEX      GET DRIVE NUMBER FROM 
COMMAND LINE
 0121 102500A4                LBCS    EXIT        EXIT ON ERROR
 0125 1F10                    TFR     X,D 
 0127 10830002                CMPD    #$0002      ENSURE 0 TO 2
 012B 1022009A                LBHI    EXIT        EXIT IF NOT
 012F 8E0800                  LDX     #WORK
 0132 E703                    STB     3,X
 0134 F70023                  STB     >DRN
 0137 8E0545                  LDX     #SURES      ASK IF SURE
 013A 8DC7                    BSR     OUTIN
 013C 10260089                LBNE    EXIT        EXIT IF NOT
 0140 8E0569                  LDX     #SCRDS      ASK IF SCRATCH DISK SURE
 0143 BDCD1E                  JSR     PSTRNG
 0146 8E0802                  LDX     #WORK+2     CLEAR BAD COUNT
 0149 6F00                    CLR     0,X
 014B 5F                      CLRB
 014C BDCD39                  JSR     OUTDEC      DISPLAY
 014F 863F                    LDA     #$3F        QUESTION MARK
 0151 BDCD18                  JSR     PUTCHR      DISPLAY
 0154 8620                    LDA     #$20        SPACE
 0156 BDCD18                  JSR     PUTCHR      DISPLAY
 0159 8DAB                    BSR     OUTIN2      GET RESPONSE
 015B 266C                    BNE     EXIT        EXIT IF SCRATCH NOT SURE
 015D 7F0025                  CLR     >DBSDF
 0160 8E05F8                  LDX     #DBST       ASK DUAL SIDE
 0163 8D9E                    BSR     OUTIN       GET RESPONSE
 0165 2608                    BNE     FORM25      SKIP IF SS
 0167 7C0025                  INC     >DBSDF      SET VALUE FOR DS
 016A 8614                    LDA     #SMAXS1
 016C B70032                  STA     >MAX
                      FORM25
 016F 7F0026                  CLR     >DENSE      SET SD
 0172 7F0027                  CLR     >DNSITY     SET SD
 0175 8E05E1                  LDX     #DDSTR      ASK DD
 0178 8D89                    BSR     OUTIN
 017A 2603                    BNE     FORM30      SKIP IF SD
 017C 7C0026                  INC     >DENSE      SET DD
 017F 8E060D          FORM30  LDX     #DTSTR      ASK 80 TRACKS L061
 0182 17FF7E                  LBSR     OUTIN
 0185 2605                    BNE     FORM40      SKIP IF 40 TRACKS
 0187 8650                    LDA     #$50        SET 80 TRACKS           
 0189 B70033                  STA     >TRACKS     SET TRACKS TO 80
 018C 8E0620          FORM40  LDX     #MNSTR      ASK VOLUME NAME L016C
 018F BDCD1E                  JSR     PSTRNG
 0192 BDCD1B                  JSR     INBUFF
 0195 8E0034                  LDX     #FKFCB
 0198 BDCD2D                  JSR     GETFIL
 019B 8E062F          FORM27  LDX     #NUMSTR     ASK VOLUME NUMBER
 019E BDCD1E                  JSR     PSTRNG
 01A1 BDCD1B                  JSR     INBUFF
 01A4 BDCD48                  JSR     INDEC
 01A7 25F2                    BCS     FORM27
 01A9 BF0043                  STX     >VOLNUM
 01AC BDCD24                  JSR     PCRLF
 01AF 8E0800                  LDX     #WORK
 01B2 BDDE0C                  JSR     DDRIVE      SELECT DRIVE
 01B5 BD06DB                  JSR     RESTOR      RESTORE DRIVE
 01B8 2720                    BEQ     FORMAT      NO SEEK ERROR AFTER RESTORE 
-> FORMAT
 01BA 8E0555                  LDX     #WPST       LOAD WRITE PROTECT MESSAGE
 01BD C540                    BITB    #$40        TEST WRITE PROTECTED FLOPPY
 01BF 260B                    BNE     EXIT2       EXIT WITH WRITE PROTECT 
MESSAGE
 01C1 8E0800                  LDX     #WORK
 01C4 BDDE0F                  JSR     DCHECK      DRIVE READY CHECK
 01C7 2411                    BCC     FORMAT      DRIVE READY -> FORMAT

                      * EXIT ROUTINES

 01C9 8E0594          EXIT    LDX     #ABORTS
 01CC BDCD1E          EXIT2   JSR     PSTRNG      
 01CF BDD403          EXIT3   JSR     FMSCLS
 01D2 1CEF                    ANDCC   #$EF
 01D4 BDCD24                  JSR             PCRLF
 01D7 7ECD03                  JMP     WARMS       EXIT

                      * MAIN FORMATTING LOOP

 01DA 8E0640          FORMAT  LDX     #INITRK     DISPLAY
 01DD BDCD1E                  JSR     PSTRNG
                              *
 01E0 1A10                    ORCC    #$10        SET INTERRUPT BIT
 01E2 7F0020                  CLR     >TRACK      TRACK 0
 01E5 7F0024          FORM3   CLR     >SIDE       SIDE 0  
 01E8 7F0021                  CLR     >SECTOR     SECTOR 0
 01EB 8D5A                    BSR     TRKHD       GO PREPARE TRACK
 01ED 8E0800          FORM32  LDX     #WORK
 01F0 7D0027                  TST     >DNSITY     TEST DENSITY
 01F3 2703                    BEQ     FORM4       SKIP IF SD
 01F5 8E0800                  LDX     #WORK
 01F8 170087          FORM4   LBSR    DOSEC       GO DO SECTOR
 01FB 7C0021                  INC     >SECTOR     INC SECTOR
 01FE B60021                  LDA     >SECTOR
 0201 7D0024                  TST     >SIDE       TEST SIDE 
 0204 2605                    BNE     FORM45      BRANCH IF SIDE 1
 0206 B10030                  CMPA    >MAXS0      TEST SECTOR WITH MAX SIDE 0
 0209 2003                    BRA     FORM46      
 020B B10031          FORM45  CMPA    >MAXS1      TEST SECTOR WITH MAX SIDE 1
 020E 26E8            FORM46  BNE     FORM4       LOOP FOR NEXT SECTOR OR END 
LOOP
 0210 B60020                  LDA     >TRACK
 0213 F60024                  LDB     >SIDE       FAKE SECTOR NUMBER - OVER 
$12 FOR SIDE 1
 0216 BDDE1B                  JSR     DSEEK       SEEK DRIVE TO TRACK
 0219 BD066E                  JSR     WTTRK       WRITE TRACK
 021C 7D0025                  TST     >DBSDF      TEST SINGLE SIDE DISK
 021F 270F                    BEQ     FORM6       SKIP IF YES
 0221 7D0024                  TST     >SIDE       TEST ACTUAL SIDE
 0224 260A                    BNE     FORM6       SKIP IF SIDE 1
 0226 B60024                  LDA     >SIDE        
 0229 8820                    EORA    #%00100000  COME HERE IF DS AND SIDE=0 
SO NOW SIDE=$20 (>$12)
 022B B70024                  STA     >SIDE       STORE NEW SIDE / FAKE SECTOR 
NUMBER
 022E 20BD                    BRA     FORM32      DO ALL AGAIN FOR SIDE 1
 0230 7C0020          FORM6   INC     >TRACK      INC TRACK
 0233 BD0384                  JSR     SWITCH      GO TO CHECK DENSITY AND 
CHANGE IF DD
 0236 B60020                  LDA     >TRACK      LOAD CURRENT TRACK
 0239 B10033                  CMPA    >TRACKS     COMPARE WITH MAX TRACK
 023C 26A7                    BNE     FORM3       LOOP FOR NEXT TRACK
                              *
 023E 8E0651                  LDX     #VRYTRK     VERIFY MESSAGE
 0241 BDCD1E                  JSR     PSTRNG
                              *
 0244 1600C8                  LBRA    SETUP       END OF FORMATTING LOOP - GO 
TO VERIFY

                      *SET UP TRACK HEADER INFORMATION

 0247 8E0800          TRKHD   LDX     #WORK       POINT TO BUFFER 
 024A 7D0027                  TST     >DNSITY     TEST DENSITY
 024D 2611                    BNE     TRHDD       SKIP IF DD
 024F C6FF                    LDB     #$FF        INIT WITH $FF
 0251 E780            TRHDS1  STB     0,X+        
 0253 8C13EA                  CMPX    #SWKEND     UNTIL FMS END FOR SD
 0256 26F9                    BNE     TRHDS1
 0258 8E081E                  LDX     #L081E
 025B 4F                      CLRA                SET IN 0
 025C C606                    LDB     #6
 025E 2015                    BRA     TRKHD1
 0260 C64E            TRHDD   LDB     #$4E        INIT WITH $4E
 0262 E780            TRHDD1  STB     0,X+        L020F
 0264 8C1FD4                  CMPX    #DWKEND     UNTIL END FOR DD
 0267 26F9                    BNE     TRHDD1
 0269 8E083C                  LDX     #L083C
 026C 4F                      CLRA                SET IN 0
 026D C60C                    LDB     #$0C
 026F 8D0B                    BSR     SET
 0271 86F6                    LDA     #$F6
 0273 C603                    LDB     #3
 0275 8D05            TRKHD1  BSR     SET         L0222
 0277 86FC                    LDA     #$FC        SET INDEX MARK
 0279 A700                    STA     0,X
 027B 39                      RTS

                      * FILL (B) BYTES OF MEMORY WITH (A) STARTING AT (X)

 027C A780            SET     STA     0,X+
 027E 5A                      DECB
 027F 26FB                    BNE     SET
 0281 39                      RTS

                      * PROCESS SECTOR IN RAM

 0282 4F              DOSEC   CLRA
 0283 7D0027                  TST     >DNSITY     DOUBLE DENSITY ?
 0286 2604                    BNE     DOSE1       SKIP IF SO
 0288 C606                    LDB     #$06        CLEAR 6 BYTES
 028A 2008                    BRA     DOSE2       DOSE2 JUMP
 028C C60C            DOSE1   LDB     #$0C        CLEAR 12 BYTES L0238
 028E 8DEC                    BSR     SET         
 0290 86F5                    LDA     #$F5        SET IN 3 $F5'S
 0292 C603                    LDB     #$03
 0294 8DE6            DOSE2   BSR     SET         L0240
 0296 86FE                    LDA     #$FE        ID ADRESS MARK
 0298 A780                    STA     0,X+        
 029A B60020                  LDA     >TRACK      GET TRACK NO
 029D A780                    STA     0,X+        
 029F F60027                  LDB     >DNSITY     DOUBLE DENSITY ?
 02A2 2705                    BEQ     DOSE3       SKIP IF NOT
 02A4 F60024                  LDB     >SIDE       GET SIDE INDICATOR
 02A7 C401                    ANDB    #$01        MAKE IT 0 OR 1
 02A9 E780            DOSE3   STB     0,X+        L0252
 02AB F60021                  LDB     >SECTOR     GET SECTOR NO
 02AE 108E050D                LDY     #SSCMAP     POINT TO CORRECT MAP
 02B2 7D0027                  TST     >DNSITY     
 02B5 2704                    BEQ     DOSE4       
 02B7 108E0521                LDY     #DSCMAP     
 02BB E6A5            DOSE4   LDB     B,Y         GET ACTUAL SECTOR L0262
 02BD E780                    STB     0,X+        
 02BF F10032                  CMPB    >MAX        END OF TRACK ?
 02C2 260A                    BNE     DOSE5       SKIP IF NOT
 02C4 4C                      INCA                BUMP TRACK NO
 02C5 5F                      CLRB                RESET SECTOR NO
 02C6 B10033                  CMPA    >TRACKS     MAXTRK END OF DISK ?
 02C9 2603                    BNE     DOSE5       SKIP IF NOT
 02CB 4F                      CLRA                SET ZERO FORWARD LINK
 02CC C6FF                    LDB     #$FF        
 02CE 5C              DOSE5   INCB                SECTOR NO L0273
 02CF 3406                    PSHS    A,B         SAVE FORWARD LINK
 02D1 8601                    LDA     #1          SECTOR LENTH = 256
 02D3 A780                    STA     0,X+        
 02D5 86F7                    LDA     #$F7        SET CRC CODE
 02D7 A780                    STA     0,X+        
 02D9 7D0027                  TST     >DNSITY     DOUBLE DENSITY ?
 02DC 2607                    BNE     DOSE6       SKIP IF SO
 02DE 300B                    LEAX    11,X        LEAVE $FF'S
 02E0 4F                      CLRA                PUT IN 6 ZEROS
 02E1 C606                    LDB     #6          
 02E3 200C                    BRA     DOSE7
 02E5 308816          DOSE6   LEAX    22,X        LEAVE $4E'S L0289
 02E8 4F                      CLRA                PUT IN 12 ZEROS
 02E9 C60C                    LDB     #$0C        
 02EB 8D8F                    BSR     SET         
 02ED 86F5                    LDA     #$F5        PUT IN 3 $F5'S
 02EF C603                    LDB     #3          
 02F1 8D89            DOSE7   BSR     SET         L0295
 02F3 86FB                    LDA     #$FB        DATA ADRESS MARK
 02F5 A780                    STA     0,X+        
 02F7 3506                    PULS    A,B         RESTORE FORWARD LINK
 02F9 ED81                    STD     0,X++       PUT IN SECTOR BUFFER
 02FB 4F                      CLRA                
 02FC C6FE                    LDB     #$FE        
 02FE 17FF7B                  LBSR    SET         
 0301 86F7                    LDA     #$F7        SET CRC CODE
 0303 A780                    STA     0,X+        
 0305 300C                    LEAX    12,X        LEAVE GAP (10)
 0307 7D0027                  TST     >DNSITY     DOUBLE DENSITY ?
 030A 2702                    BEQ     DOSECA      SKIP IF NOT
 030C 300C                    LEAX    12,X        DD NEEDS MORE GAPS
 030E 39              DOSECA  RTS


                      * DISK TESTING AND TABLE SETUP

                      * READ ALL SETORS FOR ERRORS

 030F F60032          SETUP   LDB     >MAX
 0312 B60033                  LDA     >TRACKS
 0315 4A                      DECA
 0316 FD002E                  STD     >LSTAVL     SET LAST AVAIL.
 0319 3D                      MUL                 FIND TOTAL SECTORS
 031A FD002A                  STD     >SECCNT     SAVE IT
 031D 8E0101                  LDX     #FIRST      SET FIRST AVAIL
 0320 BF002C                  STX     >FSTAVL     
 0323 B60023                  LDA     >DRN        
 0326 B70803                  STA     WORK+3      
 0329 4F                      CLRA                CLEAR COUNTER
 032A B70022                  STA     >BADCNT     
 032D B70020                  STA     >TRACK      SET TRACK
 0330 B70027                  STA     >DNSITY     SINGLE DENSITY FOR TRACK 0
 0333 4C                      INCA                
 0334 B70021                  STA     >SECTOR     SET SECTOR
 0337 860A                    LDA     #SMAX0      RESET MAXIMUM
 0339 B70030                  STA     >MAXS0      SECTOR COUNTS
 033C 8614                    LDA     #SMAXS1     
 033E B70031                  STA     >MAXS1      
 0341 7D0025                  TST     >DBSDF      DOUBLE SIDED ?
 0344 2602                    BNE     SETUP1      SKIP IF SO
 0346 860A                    LDA     #SMAX0      
 0348 B70032          SETUP1  STA     >MAX        MAXIMUM SECTORS
 034B 8D2B            SETUP2  BSR     CHKSEC      GO CHECK SECTORS
 034D 2660                    BNE     REMSEC      ERROR ?
 034F 7F0022                  CLR     >BADCNT     CLEAR COUNTER
 0352 FC0020          SETUP4  LDD     >TRACK      GET TRACK AND SECTOR
 0355 8D4A                    BSR     FIXSEC      GET TO NEXT ADR
 0357 102700E7                LBEQ    DOTRK       SKIP IF FINISHED
                              *
 035B 3416                    PSHS    D,X         DISPLAY TRACK SECTOR
 035D 8608                    LDA     #$08        BACKSPACE
 035F BDCD18                  JSR     PUTCHR
 0362 BDCD18                  JSR     PUTCHR
 0365 BDCD18                  JSR     PUTCHR
 0368 BDCD18                  JSR     PUTCHR
 036B 8E0020                  LDX     #TRACK
 036E BDCD45                  JSR     OUTADR
 0371 3516                    PULS    D,X
                              *
 0373 FD0020                  STD     >TRACK      SET TRACK AND SECTOR
 0376 20D3                    BRA     SETUP2      REPEAT
 0378 8E0800          CHKSEC  LDX     #WORK       POINT TO FCB
 037B FC0020                  LDD     >TRACK      GET TRACK AND SECTOR
 037E ED881E                  STD     30,X        SET CURRENT TRACK AND SECTOR
 0381 7E042B                  JMP     READSS      GO DO READ

                      * CHANGE TO DD IF REQUIRED

 0384 F60026          SWITCH  LDB     >DENSE      DOUBLE DENSITY DISK ?
 0387 2717                    BEQ     SWICH2      SKIP IF NOT
 0389 F70027                  STB     >DNSITY     SET FLAG
 038C C612                    LDB     #DMAXS0     RESET SECTOR COUNTS
 038E F70030                  STB     >MAXS0      
 0391 C624                    LDB     #DMAXS1     
 0393 F70031                  STB     >MAXS1      
 0396 7D0025                  TST     >DBSDF      TEST DOUBLE SIDED
 0399 2602                    BNE     SWICH1      SKIP IF SO
 039B C612                    LDB     #DMAXS0
 039D F70032          SWICH1  STB     >MAX
 03A0 39              SWICH2  RTS

                      * SET TRACK AND SECTOR TO NEXT 

 03A1 F10032          FIXSEC  CMPB    >MAX        END OF TRACK?
 03A4 2604                    BNE     FEXSE4      
 03A6 4C                      INCA                BUMP TRACK
 03A7 8DDB                    BSR     SWITCH      SWITCH TO DD IF NCSSRY
 03A9 5F                      CLRB                SECTOR NO.
 03AA 5C              FEXSE4  INCB                SECTOR NO.
 03AB B10033                  CMPA    >TRACKS     END OF DISK ?
 03AE 39                      RTS

                      * REMOVE BAD SECTOR FROM FREE CHAIN

 03AF 7C0022          REMSEC  INC     >BADCNT     UPDATE COUNTER
 03B2 270C                    BEQ     REMSE1      COUNT OVERFLOW?
 03B4 B60020                  LDA     >TRACK      GET TRACK
 03B7 260D                    BNE     REMSE2      TRACK 0 ?
 03B9 F60021                  LDB     >SECTOR     GET SECTOR
 03BC C105                    CMPB    #5          PAST DIRECTORY ?
 03BE 2206                    BHI     REMSE2       
 03C0 8E0580          REMSE1  LDX     #FATERS     REPORT FATAL ERROR L032D
 03C3 7E01CC                  JMP     EXIT2       REPORT IT
 03C6 8E0800          REMSE2  LDX     #WORK       POINT TO FCB L0333
 03C9 FC002C                  LDD     >FSTAVL     GET OUTIN TRACK AND SECTOR
 03CC 10B30020                CMPD    >TRACK      CHECK TRACK AND SECTOR
 03D0 2607                    BNE     REMSE3       
 03D2 8DCD                    BSR     FIXSEC      SET TO NEXT
 03D4 FD002C                  STD     >FSTAVL     GO DO NEXT
 03D7 202B                    BRA     REMSE7      SET NEW ADR
 03D9 FC0020          REMSE3  LDD     >TRACK      GET TRACK AND SECTOR L0343
 03DC F00022                  SUBB    >BADCNT     
 03DF 2702                    BEQ     REMSE4      UNDERFLOW ?
 03E1 2A04                    BPL     REMSE5       
 03E3 4A              REMSE4  DECA                TRACK L034B
 03E4 F60032                  LDB     >MAX        RESET SECTOR
 03E7 ED881E          REMSE5  STD     30,X        SET CURRENT AD L034E
 03EA 8D3F                    BSR     READSS      GO DO READ
 03EC 26D2                    BNE     REMSE1      ERROR ?
 03EE EC8840                  LDD     64,X        SET LINK ADR
 03F1 8DAE                    BSR     FIXSEC      POINT TO NEXT
 03F3 2608                    BNE     REMSE6      OVERFLOW ?
 03F5 EC881E                  LDD     30,X        GET CURRENT ADR
 03F8 FD002E                  STD     >LSTAVL     SET NEW LAST AVAIL
 03FB 4F                      CLRA                
 03FC 5F                      CLRB                
 03FD ED8840          REMSE6  STD     64,X        SET NEW LINK L0363
 0400 8D33                    BSR     WRITSS      GO DO WRITE
 0402 26BC                    BNE     REMSE1      ERROR?
 0404 BE002A          REMSE7  LDX     >SECCNT     GET SEC COUNT L036A
 0407 301F                    LEAX    -1,X        DEC IT ONCE
 0409 BF002A                  STX     >SECCNT     SAVE NEW COUNT
 040C 8E05AA                  LDX     #DABSS      REPORT BAD SECTOR
 040F BDCD1E                  JSR     PSTRNG      OUTPUT IT
 0412 8E0020                  LDX     #TRACK      POINT TO ADDRESS
 0415 BDCD3C                  JSR     OUTHEX      OUTPUT IT
                              *
 0418 8E0651                  LDX             #VRYTRK         DISPLAY NORMAL 
VERIFY MESSAGE
 041B BDCD1E                  JSR             PSTRNG          OUTPUT IT
                              *
 041E 8620                    LDA     #$20        
 0420 BDCD18                  JSR     PUTCHR      
 0423 3001                    LEAX    1,X         BUMP TO NEXT
 0425 BDCD3C                  JSR     OUTHEX      
 0428 7E0352                  JMP     SETUP4      CONTINUE

                      *READ A SECTOR

 042B 8E0800          READSS  LDX     #WORK       POINT TO FCB
 042E 8609                    LDA     #9          SET UP COMMAND
 0430 A700                    STA     0,X         
 0432 7ED406                  JMP     FMS         GO DO IT
                                                  
                      *WRITE A SECTOR             
                                                  
 0435 8E0800          WRITSS  LDX     #WORK       POINT TO FCB
 0438 860A                    LDA     #SMAX0      SETUP COMMAND
 043A A700                    STA     0,X         
 043C BDD406                  JSR     FMS         GO DO IT
 043F 27EA                    BEQ     READSS      ERRORS ?
 0441 39                      RTS

                      *SETUP SIR

 0442 7F0027          DOTRK   CLR     >DNSITY     BACK TO SINGLE DENSITY
 0445 8E0800                  LDX     #WORK       POINT TO SPACE
 0448 6F881E                  CLR     30,X        SET TO DIS
 044B 8603                    LDA     #3          SECTOR 3
 044D A7881F                  STA     31,X        
 0450 8DD9                    BSR     READSS      READ IN SIR SECTOR
 0452 2650                    BNE     DOTRK3      ERRORS ?
 0454 8E0800                  LDX     #WORK       FIX POINTER
 0457 6F8840                  CLR     64,X        CLEAR FORWARD LINK
 045A 6F8841                  CLR     65,X        
 045D FC002C                  LDD     >FSTAVL     ADDR OF OUTIN FREE SECTOR
 0460 ED885D                  STD     93,X        SET IN SIR (93)
 0463 FC002E                  LDD     >LSTAVL     ADDR OF LAST FREE SECTOR
 0466 ED885F                  STD     95,X        SET IN SIR
 0469 FC002A                  LDD     >SECCNT     GET TOTAL SECTOR COUNT
 046C ED8861                  STD     97,X        PUT IN SIR
 046F B60033                  LDA     >TRACKS     GET MAX TRACK NO
 0472 4A                      DECA                
 0473 F60030                  LDB     >MAXS0      
 0476 7D0025                  TST     >DBSDF      DOUBLE SIDED ?
 0479 2703                    BEQ     DOTRK1
 047B F60031                  LDB     >MAXS1      CHANGE FOR DOUBLE SIDED
 047E ED8866          DOTRK1  STD     102,X       SAVE MAX TRACK AND SECTOR 
L03D4
 0481 FCCC0E                  LDD     >SYSMTH     MONTH INTO SIR
 0484 ED8863                  STD     99,X        
 0487 B6CC10                  LDA     >SYSYR      SET YEAR INTO SIR
 048A A78865                  STA     101,X       
 048D C60D                    LDB     #$0D        
 048F 108E0038                LDY     #VOLNAM     POINT TO VOLUME NAME
 0493 8E0800                  LDX     #WORK       
 0496 A6A0            DOTRK2  LDA     0,Y+        COPY NAME TO SIR L03EC
 0498 A78850                  STA     80,X        
 049B 3001                    LEAX    1,X         
 049D 5A                      DECB                DEC THE COUNT
 049E 26F6                    BNE     DOTRK2       
 04A0 8D93                    BSR     WRITSS      WRITE SIR BACK OUT
 04A2 2703                    BEQ     DIRINT      SKIP IF NO ERROR
 04A4 7E03C0          DOTRK3  JMP     REMSE1      GO REPORT ERROR L03FA

                      * INITIALISE DIRECTORY

 04A7 8E0800          DIRINT  LDX     #WORK       SET POINTER TO FCB
 04AA 860A                    LDA     #SMAX0      GET MAX FOR TRACK 0
 04AC 7D0025                  TST     >DBSDF       SINGLE SIDED ?
 04AF 2702                    BEQ     DIRIN1      SKIP IF SO
 04B1 8614                    LDA     #SMAXS1     SET MAX FOR DS
 04B3 A7881F          DIRIN1  STA     31,X        SET UP L0408
 04B6 BD042B                  JSR     READSS      READ IN SECTOR
 04B9 26E9                    BNE     DOTRK3      ERRORS ?
 04BB 8E0800                  LDX     #WORK       RESTORE POINTER
 04BE 6F8840                  CLR     64,X        CLEAR LINK
 04C1 6F8841                  CLR     65,X        
 04C4 BD0435                  JSR     WRITSS      WRITE BACK OUT
 04C7 26DB                    BNE     DOTRK3      ERRORS ?
 04C9 8EC100                  LDX     #CMDADR
 04CC 4F                      CLRA                TRACK 0
 04CD C601                    LDB     #1          SECTOR 1
 04CF BDDE03                  JSR     DWRITE      WRITE THE SECTOR
 04D2 26D0                    BNE     DOTRK3      ERRORS ?
                              
                      * SAVE BOOT IN TRACK 0 SECTOR 1

 04D4 8EC100          DOBOOT  LDX     #CMDADR
 04D7 4F                      CLRA                TRACK #0
 04D8 C601                    LDB     #$01        SECTOR #1
 04DA BDDE03                  JSR     DWRITE      WRITE THE SECTOR
 04DD 26C5                    BNE     DOTRK3      ERRORS ?

                      *REPORT TOTAL SECTORS AND EXIT

 04DF 8E0800                  LDX     #WORK       SET UP AN FCB
 04E2 8610                    LDA     #$10        OPEN SIR FUNCTION
 04E4 A700                    STA     0,X         
 04E6 BDD406                  JSR     FMS         OPEN THE SIR
 04E9 26B9                    BNE     DOTRK3      ERRORS ?
 04EB 8607                    LDA     #7          INFO RECORD FUNCTION
 04ED A700                    STA     0,X         
 04EF BDD406                  JSR     FMS         OUTIN INFO RECORD
 04F2 26B0                    BNE     DOTRK3      REPORT FORMATTING COMPLETE
 04F4 8E05BA                  LDX     #CMPLTE     REPORT FORMATTING COMPLETE
 04F7 BDCD24                  JSR     PCRLF
 04FA BDCD1E                  JSR     PSTRNG      OUTPUT IT
 04FD 8E05D0                  LDX     #SECST      PRINT TOTAL SECTOR STRING
 0500 BDCD1E                  JSR     PSTRNG      OUTPUT IT
 0503 8E0815                  LDX     #L0815      TOTAL IS IN INFO RECORD
 0506 5F                      CLRB                
 0507 BDCD39                  JSR     OUTDEC      PRINT NUMBER
 050A 7E01CF                  JMP     EXIT3       ALL DONE - GO TO EXIT

                      *SECTOR MAPS

 050D 01030507090204  SSCMAP  FCB     $01,$03,$05,$07,$09,$02,$04,$06
 0514 06
 0515 080A                    FCB     $08,$0A
 0517 0B0D0F11130C0E          FCB     11,13,15,17,19,12,14,16,18,20
 051E 101214
 0521 01030507090B0D  DSCMAP  FCB     $01,$03,$05,$07,$09,$0B,$0D,$0F
 0528 0F
 0529 11020406080A0C          FCB     $11,$02,$04,$06,$08,$0A,$0C,$0E
 0530 0E
 0531 1012                    FCB     $10,$12
 0533 131517191B1D1F          FCB     19,21,23,25,27,29,31,33,35,20,22,24,26,28,
30,32,34,36
 053A 21231416181A1C
 0541 1E202224

                      * DISPLAYED MESSAGES

 0545 41726520796F75  SURES   FCC     "Are you sure ? "
 054C 2073757265203F
 0553 20
 0554 04                      FCB     EOT
 0555 4469736B206973  WPST    FCC     "Disk is protected !"
 055C 2070726F746563
 0563 7465642021
 0568 04                      FCB     EOT
 0569 53637261746368  SCRDS   FCC     "Scratch disk in drive "
 0570 206469736B2069
 0577 6E206472697665
 057E 20
 057F 04                      FCB     EOT
 0580 070707          FATERS  FCB     BEL,BEL,BEL
 0583 466174616C2065          FCC     "Fatal error "
 058A 72726F7220
 058F 2D2D2D20                FCC     "--- "
 0593 04                      FCB     EOT
 0594 466F726D617474  ABORTS  FCC     "Formatting aborted ! "
 059B 696E672061626F
 05A2 72746564202120
 05A9 04                      FCB     EOT
 05AA 07              DABSS   FCB     BEL
 05AB 42616420736563          FCC     "Bad sector at "
 05B2 746F7220617420
 05B9 04                      FCB     EOT
 05BA 07              CMPLTE  FCB     BEL
 05BB 466F726D617474          FCC     "Formatting complete."
 05C2 696E6720636F6D
 05C9 706C6574652E
 05CF 04                      FCB     EOT
 05D0 546F74616C2073  SECST   FCC     "Total sectors = "
 05D7 6563746F727320
 05DE 3D20
 05E0 04                      FCB     EOT
 05E1 446F75626C6520  DDSTR   FCC     "Double density disk ? "
 05E8 64656E73697479
 05EF 206469736B203F
 05F6 20
 05F7 04                      FCB     EOT
 05F8 446F75626C6520  DBST    FCC     "Double sided disk ? "
 05FF 73696465642064
 0606 69736B203F20
 060C 04                      FCB     EOT
 060D 38302074726163  DTSTR   FCC     "80 tracks drive ? "
 0614 6B732064726976
 061B 65203F20
 061F 04                      FCB     EOT
 0620 566F6C756D6520  MNSTR   FCC     "Volume name ? "
 0627 6E616D65203F20
 062E 04                      FCB     EOT
 062F 566F6C756D6520  NUMSTR  FCC     "Volume number ? "
 0636 6E756D62657220
 063D 3F20
 063F 04                      FCB     EOT
 0640 57726974652074  INITRK  FCC     "Write track :   "
 0647 7261636B203A20
 064E 2020
 0650 04                      FCB     EOT
 0651 56657269667920  VRYTRK  FCC     "Verify track/sector :     "
 0658 747261636B2F73
 065F 6563746F72203A
 0666 2020202020
 066B 04                      FCB     EOT

                      * TEMP1 = BUFFER END - CHANGE IF SD OR DD

 066C                 TEMP1   RMB     2

                      * WRITE TRACK ROUTINE

 066E 3420            WTTRK   PSHS    Y
                              *
 0670 8608                    LDA     #$08        DISPLAY TRACK - LOAD 
BACKSPACE
 0672 BDCD18                  JSR     PUTCHR
 0675 BDCD18                  JSR     PUTCHR
 0678 8E0020                  LDX     #TRACK
 067B BDCD3C                  JSR     OUTHEX
                              *
 067E F60023                  LDB     >DRN
 0681 86EC                    LDA     #$EC
 0683 1E8B                    EXG     A,DP        SET DP TO $EC
 0685 3402                    PSHS    A           SAVE OLD DP
 0687 8EDE80                  LDX     #DSKTAB     LOAD DSKTAB ADDRESS
 068A A604                    LDA     04,X        LOAD LATCH RAM COPY FROM 
$DE80+4
 068C 7D0027                  TST     >DNSITY     TEST SD DENSITY ?
 068F 2714                    BEQ     WTTRK1      SKIP IF SD
 0691 84BF                    ANDA    #%10111111  CLEAR DENSITY BIT -> DD
 0693 970C                    STA     <DRVREG     STORE TO LATCH
 0695 A704                    STA     $04,X       STORE TO LATCH RAM COPY
 0697 3008                    LEAX    $08,X       COMPUTE DRIVE DENSITY TABLE 
ADDRESS $DE80+8
 0699 8601                    LDA     #$01      
 069B A785                    STA     B,X         MARK DRIVE AS DD IN DISK 
TABLE
                      *                           LDA    <DRVREG
 069D 8E1FD4                  LDX     #DWKEND     END BUFFER ADDRESS DD
 06A0 BF066C                  STX     >TEMP1
 06A3 2011                    BRA     WTTRK2
 06A5 8A40            WTTRK1  ORA     #%01000000  SET DENSITY BIT -> SD L056B
 06A7 970C                    STA     <DRVREG     STORE TO LATCH
 06A9 A704                    STA     $04,X       STORE TO LATCH RAM COPY
 06AB 3008                    LEAX    $08,X       COMPUTE DENSITY TABLE 
ADDRESS
 06AD 4F                      CLRA                
 06AE A785                    STA     B,X         MARK DRIVE AS SD IN DISK 
TABLE
                      *                           LDA    <DRVREG    
 06B0 8E13EA                  LDX     #SWKEND     END BUFFER ADDRESS SD
 06B3 BF066C                  STX     >TEMP1
 06B6 86F4            WTTRK2  LDA     #$F4        LOAD WRITE TRACK COMMAND 
L0577
 06B8 9704                    STA     <COMREG
 06BA BD0712                  JSR     DELAY
 06BD C602                    LDB     #2          LOAD DRQ TEST VALUE
 06BF 8E0800                  LDX     #WORK
 06C2 A680            WTTRK3  LDA     0,X+        LOAD DATA FROM BUFFER
 06C4 D504            WTTRK5  BITB    <COMREG     TEST DRQ ? L0583
 06C6 27FC                    BEQ     WTTRK5      WAIT MORE IF NOT
 06C8 9707                    STA     <DATREG     WRITE DATA
 06CA BC066C                  CMPX    >TEMP1      COMPARE TO BUFFER END 
ADDRESS
 06CD 26F3                    BNE     WTTRK3      LOOP - MORE DATA TO WRITE
 06CF 9604            WTTRK4  LDA     <COMREG     L0590
 06D1 8501                    BITA    #1          TEST BUSY   
 06D3 26FA                    BNE     WTTRK4      WAIT MORE IF BUSY
 06D5 3502                    PULS    A
 06D7 1E8B                    EXG     A,DP        RESTORE DP
 06D9 35A0                    PULS    Y,PC
                       
                      * DRIVE RESTORE SUBROUTINE

 06DB 3452            RESTOR  PSHS    U,X,A
 06DD 86EC                    LDA     #$EC
 06DF 1E8B                    EXG     A,DP
 06E1 3402                    PSHS    A           SAVE OLD DP
 06E3 B60023                  LDA     >DRN        GET DRIVE NUMBER
 06E6 CEDE80                  LDU     #DSKTAB
 06E9 8D1D                    BSR     WATFDC      CHECK FDC NOT BUSY 
 06EB C600                    LDB     #$00        RESTORE COMMAND   
 06ED EA41                    ORB     $01,U       ADD STEP RATE
 06EF D704                    STB     <COMREG     SEND TO FDC
 06F1 8D1F                    BSR     DELAY       WAIT
 06F3 8D13                    BSR     WATFDC
 06F5 D604                    LDB     <COMREG
 06F7 6F42                    CLR     $02,U       CLEAR CURRENT TRACK
 06F9 6F43                    CLR     $03,U       CLEAR CURRENT SECTOR
 06FB 3045                    LEAX    $05,U
 06FD 6F86                    CLR     A,X         CLEAR DRIVE TRACK MEMORY
 06FF C558                    BITB    #$58        CHECK FOR WP, SEEK AND CRC 
ERROR
 0701 3502                    PULS    A
 0703 1E8B                    EXG     A,DP        RESTORE OLD DP
 0705 3552                    PULS    U,X,A
 0707 39                      RTS
                                  
                      * WAIT FDC NOT BUSY

 0708 3404            WATFDC  PSHS    B      
 070A D604            ZF164   LDB     <COMREG   
 070C C401                    ANDB    #$01   
 070E 26FA                    BNE     ZF164  
 0710 3584                    PULS    PC,B   
                            
                      * DELAY SUBROUTINE
                              
 0712 BD0715          DELAY   JSR     DEL1
 0715 BD0718          DEL1    JSR     DEL0
 0718 39              DEL0    RTS
                        
                      *********************************************        
                                     
                      * SINGLE OR DOUBLE DENSITY LOADER FOR EC-6809

                      * CONSTANTS

                      * EXTERNAL LABEL EQUATES

                      *COMREG  EQU     $EC04      FLOPPY CTLR
 EC05                 TRKREG  EQU     $EC05
 EC06                 SECREG  EQU     $EC06
                      *DATREG  EQU     $EC07
                      *DRVREG  EQU     $EC0C
 C080                 STACK   EQU     $C080
 C300                 SCTBUF  EQU     $C300

                              ORG     $C100

 C100 200B            CMDADR  BRA     CMDSTA

 C102 0000                    FCB     $00,$00
 C104 00                      FCB     $00
 C105 1C              FLXTRK  FCB     $1C         FILE START TRACK
 C106 01                      FCB     $01         FILE START SECTOR
 C107 00              DNS     FCB     $00         DENSITY FLAG
 C108 C100            TADR    FCB     $C1,$00     TRANSFER ADDRESS
 C10A 0000            LADR1   FCB     $00,$00
 C10C 00                      FCB     $00

 C10D 10CEC080        CMDSTA  LDS     #STACK      SETUP STACK
 C111 FCC105                  LDD     FLXTRK      GET TRANSFER ADDRESS
 C114 FDC300                  STD     SCTBUF      SETUP STARTING TRK & SCT
 C117 108EC400                LDY     #SCTBUF+256
                              
                      * MESSAGES

 C11B 8EC1E7                  LDX    #MLOAD
 C11E 3F                      SWI
 C11F 03                      FCB     $03         PRINT
 C120 3F                      SWI
 C121 06                      FCB     $06
                              
                      * PERFORM ACTUAL BOOT LOAD

 C122 8D35            LOAD1   BSR     GETCH       GET A CHARACTER
 C124 8102                    CMPA    #$02        DATA RECORD HEADER ?
 C126 2710                    BEQ     LOAD2       SKIP IF SO
 C128 8116                    CMPA    #$16        XFR ADDRESS HEADER?
 C12A 26F6                    BNE     LOAD1       LOOP IF NEITHER
 C12C 8D2B                    BSR     GETCH       GET TRANSFER ADDRESS
 C12E B7C108                  STA     TADR
 C131 8D26                    BSR     GETCH
 C133 B7C109                  STA     TADR+1
 C136 20EA                    BRA     LOAD1       CONTINUE LOAD
                              
 C138 8D1F            LOAD2   BSR     GETCH       GET LOAD ADDRESS
 C13A B7C10A                  STA     LADR1
 C13D 8D1A                    BSR     GETCH
 C13F B7C10B                  STA     LADR1+1
 C142 8D15                    BSR     GETCH       GET BYTE COUNT
 C144 1F89                    TFR     A,B         PUT IN B
 C146 4D                      TSTA
 C147 27D9                    BEQ     LOAD1       LOOP IF COUNT = 0
 C149 BEC10A                  LDX     LADR1       GET LOAD ADDRESS
 C14C 3414            LOAD3   PSHS    B,X
 C14E 8D09                    BSR     GETCH       GET A DATA CHARACTER
 C150 3514                    PULS    B,X
 C152 A780                    STA     ,X+         PUT CHARACTER
 C154 5A                      DECB                END OF DATA IN RECORD ?
 C155 26F5                    BNE     LOAD3       LOOP IF NOT
 C157 20C9                    BRA     LOAD1       GET ANOTHER RECORD

                      * GET CHARACTER ROUTINE

 C159 108CC400        GETCH   CMPY    #SCTBUF+256 OUT OF DATA ?
 C15D 260F                    BNE     GETCH4      GO READ CHARACTER IF NOT
 C15F 8EC300                  LDX     #SCTBUF     POINT TO BUFFER
 C162 EC00                    LDD     0,X         GET FORWARD LINK
 C164 270B                    BEQ     GO          IF ZERO, FILE IS LOADED
 C166 8D0D                    BSR     READ        READ NEXT SECTOR
 C168 2696                    BNE     CMDADR      START OVER IF ERROR
 C16A 108EC304                LDY     #SCTBUF+4   POINT PAST LINK
 C16E A6A0            GETCH4  LDA     ,Y+         ELSE GET A CHARACTER
 C170 39                      RTS

                      * FILE IS LOADED, JUMP TO IT

 C171 6E9FC108        GO      JMP     [TADR]

                      * READ SINGLE SECTOR

 C175 8D37            READ    BSR     SEEK
 C177 8680                    LDA     #$80        READ CMD
 C179 B7EC04          SUIT1   STA     COMREG      APPLY CMD
 C17C 170061                  LBSR    DEL28
 C17F 5F                      CLRB
 C180 8EC300                  LDX     #SCTBUF     LOAD DESTINATION
 C183 B6EC04          READ3   LDA     COMREG
 C186 8502                    BITA    #2          DRQ ?
 C188 2608                    BNE     READ5
 C18A 8501                    BITA    #1          BUSY ?
 C18C 26F5                    BNE     READ3       LOOP IF YES
 C18E 1F89                    TFR     A,B
 C190 200A                    BRA     READ6
                              
 C192 B6EC07          READ5   LDA     DATREG
 C195 A780                    STA     ,X+
 C197 5A                      DECB
 C198 26E9                    BNE     READ3       NEXT BYTE
 C19A 8D0A                    BSR     WAIT
 C19C C510            READ6   BITB    #$10        CHECK RNF
 C19E 2703                    BEQ     READ8       NO, JUMP
 C1A0 73C107                  COM     DNS         CHANGE DENSITY FOR NEXT READ
 C1A3 C51C            READ8   BITB    #$1C        CHECK FOR ERROR
 C1A5 39                      RTS
                       
                      * ATTENTE FIN DE COMMANDE

 C1A6 F6EC04          WAIT    LDB     COMREG
 C1A9 C501                    BITB    #1
 C1AB 26F9                    BNE     WAIT
 C1AD 39                      RTS

                      * SEEK

 C1AE 3402            SEEK    PSHS    A
 C1B0 7DC107                  TST     DNS
 C1B3 2708                    BEQ     SIMPLE      SIMPLE DENSITY

                      * DOUBLE DENSITY

 C1B5 8601                    LDA     #%00000001  DRIVE 0/DD
 C1B7 C112                    CMPB    #18         SECTOR BY SIDE
 C1B9 230A                    BLS     SEEK1       GO SIDE 0
 C1BB 2006                    BRA     SEEK2       GO SIDE 1

                      * SIMPLE DENSITY 

 C1BD 8641            SIMPLE  LDA     #%01000001  DRIVE 0/SD
 C1BF C10A                    CMPB    #10         SECTOR BY SIDE 
 C1C1 2302                    BLS     SEEK1       SIDE 0
 C1C3 8A10            SEEK2   ORA     #%00010000  FORCE SIDE 1
 C1C5 F7EC06          SEEK1   STB     SECREG
 C1C8 B7EC0C                  STA     DRVREG      SETS DRIVE REG
 C1CB 3502                    PULS    A
 C1CD B1EC05                  CMPA    TRKREG      CHANGE TRACK ?
 C1D0 270E                    BEQ     DEL28       NO, JUMP
 C1D2 B7EC07                  STA     DATREG      NEW TRACK
 C1D5 8D09                    BSR     DEL28
 C1D7 861B                    LDA     #$1B
 C1D9 B7EC04                  STA     COMREG
 C1DC 8D02                    BSR     DEL28
 C1DE 8DC6                    BSR     WAIT

                      * BOUCLE DELAI

 C1E0 BDC1E3          DEL28   JSR     DEL14
 C1E3 BDC1E6          DEL14   JSR     DEL
 C1E6 39              DEL     RTS

 C1E7 4C6F6164696E67  MLOAD FCC "Loading..."
 C1EE 2E2E2E
 C1F1 04                    FCB $04

                            ORG     $C200-4
 C1FC 464C4558              FCB     'F', 'L', 'E', 'X'

                      *      END     CMDADR

 0100                       END     NEWDISK

SYMBOL TABLE
    ABORTS 02 0594    BADCNT 00 0022       BEL 00 0007    CHKSEC 02 0378
    CMDADR 02 C100    CMDSTA 02 C10D    CMPLTE 02 05BA    COMREG 00 EC04
     DABSS 02 05AA    DATREG 00 EC07     DBSDF 00 0025      DBST 02 05F8
    DCHECK 00 DE0F    DDRIVE 00 DE0C     DDSTR 02 05E1       DEL 02 C1E6
      DEL0 02 0718      DEL1 02 0715     DEL14 02 C1E3     DEL28 02 C1E0
     DELAY 02 0712     DENSE 00 0026    DIRIN1 02 04B3    DIRINT 02 04A7
    DMAXS0 00 0012    DMAXS1 00 0024       DNS 02 C107    DNSITY 00 0027
    DOBOOT 02 04D4     DOSE1 02 028C     DOSE2 02 0294     DOSE3 02 02A9
     DOSE4 02 02BB     DOSE5 02 02CE     DOSE6 02 02E5     DOSE7 02 02F1
     DOSEC 02 0282    DOSECA 02 030E     DOTRK 02 0442    DOTRK1 02 047E
    DOTRK2 02 0496    DOTRK3 02 04A4       DRN 00 0023    DRVREG 00 EC0C
    DSCMAP 02 0521     DSEEK 00 DE1B    DSKTAB 00 DE80     DTSTR 02 060D
    DWKEND 00 1FD4    DWRITE 00 DE03       EOT 00 0004      EXIT 02 01C9
     EXIT2 02 01CC     EXIT3 02 01CF    FATERS 02 0580    FEXSE4 02 03AA
     FIRST 00 0101    FIXSEC 02 03A1     FKFCB 00 0034    FLXTRK 02 C105
       FMS 00 D406    FMSCLS 00 D403     FORM1 02 010E    FORM25 02 016F
    FORM27 02 019B     FORM3 02 01E5    FORM30 02 017F    FORM32 02 01ED
     FORM4 02 01F8    FORM40 02 018C    FORM45 02 020B    FORM46 02 020E
     FORM6 02 0230    FORMAT 02 01DA    FSTAVL 00 002C     GETCH 02 C159
    GETCH4 02 C16E    GETCHR 00 CD15    GETFIL 00 CD2D    GETHEX 00 CD42
        GO 02 C171    INBUFF 00 CD1B     INDEC 00 CD48    INITRK 02 0640
     L0815 00 0815     L081E 00 081E     L083C 00 083C     LADR1 02 C10A
     LOAD1 02 C122     LOAD2 02 C138     LOAD3 02 C14C    LSTAVL 00 002E
       MAX 00 0032     MAXS0 00 0030     MAXS1 00 0031     MLOAD 02 C1E7
     MNSTR 02 0620   NEWDISK 02 0100    NUMSTR 02 062F    OUTADR 00 CD45
    OUTDEC 00 CD39    OUTHEX 00 CD3C     OUTIN 02 0103    OUTIN2 02 0106
     PCRLF 00 CD24    PSTRNG 00 CD1E    PUTCHR 00 CD18      READ 02 C175
     READ3 02 C183     READ5 02 C192     READ6 02 C19C     READ8 02 C1A3
    READSS 02 042B    REMSE1 02 03C0    REMSE2 02 03C6    REMSE3 02 03D9
    REMSE4 02 03E3    REMSE5 02 03E7    REMSE6 02 03FD    REMSE7 02 0404
    REMSEC 02 03AF    RESTOR 02 06DB     SCRDS 02 0569    SCTBUF 00 C300
    SECCNT 00 002A    SECREG 00 EC06     SECST 02 05D0    SECTOR 00 0021
      SEEK 02 C1AE     SEEK1 02 C1C5     SEEK2 02 C1C3       SET 02 027C
     SETUP 02 030F    SETUP1 02 0348    SETUP2 02 034B    SETUP4 02 0352
      SIDE 00 0024    SIMPLE 02 C1BD     SMAX0 00 000A    SMAXS0 00 000A
    SMAXS1 00 0014    SSCMAP 02 050D     STACK 00 C080     SUIT1 02 C179
     SURES 02 0545    SWICH1 02 039D    SWICH2 02 03A0    SWITCH 02 0384
    SWKEND 00 13EA    SYSMTH 00 CC0E     SYSYR 00 CC10      TADR 02 C108
     TEMP1 02 066C      TKSZ 00 0BEA     TRACK 00 0020    TRACKS 02 0033
     TRHDD 02 0260    TRHDD1 02 0262    TRHDS1 02 0251     TRKHD 02 0247
    TRKHD1 02 0275    TRKREG 00 EC05    VOLNAM 00 0038    VOLNUM 00 0043
    VRYTRK 02 0651      WAIT 02 C1A6     WARMS 00 CD03    WATFDC 02 0708
      WORK 00 0800      WPST 02 0555    WRITSS 02 0435     WTTRK 02 066E
    WTTRK1 02 06A5    WTTRK2 02 06B6    WTTRK3 02 06C2    WTTRK4 02 06CF
    WTTRK5 02 06C4     ZF164 02 070A
178 SYMBOLS

0 error(s), 0 warning(s)
